<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mock Data Forge — UI</title>

 
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">

  
  <style>
    :root {
      --accent: #00ff7f; 
      --panel-bg: rgba(255,255,255,0.03);
      --muted: rgba(255,255,255,0.65);
      --card-border: rgba(255,255,255,0.04);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
    }

    html[data-bs-theme="dark"], body { background: #0a0a0a; color: #e6ffe6; }

    .topbar {
      background: transparent;
      border-bottom: 1px solid var(--card-border);
      padding: 12px 20px;
      display:flex;
      align-items:center;
      gap:12px;
    }

    .brand { display:flex; align-items:center; gap:12px; }

    .logo {
      width:48px; height:48px; border-radius:50%; overflow:hidden; display:flex; align-items:center; justify-content:center;
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 0 10px rgba(0,255,127,0.06);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    }
    .logo img { width:100%; height:100%; object-fit:cover; }

    .brand h1 { margin:0; font-size:1.15rem; font-weight:700; letter-spacing:0.4px; color:#e9ffe9; }
    .brand .muted { margin:0; font-size:0.8rem; color:var(--muted); }

    .rows-input { width:110px; }

    
    .main-grid { padding:18px; display:flex; gap:18px; align-items:flex-start; }
    .left-panel { width:44%; min-width:380px; }
    .right-panel { width:56%; min-width:360px; }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid var(--card-border);
      color: #eafae6;
    }

    .panel-header { display:flex; justify-content:space-between; align-items:center; padding:12px 16px; border-bottom:1px solid var(--card-border); }
    .panel-header h2 { margin:0; font-size:1.05rem; }

    .fields-list { padding:12px 16px; display:flex; flex-direction:column; gap:8px; max-height:60vh; overflow:auto; }
    .field-row {
      display:flex; gap:8px; align-items:center; padding:8px; border-radius:8px;
      background: rgba(0,0,0,0.12);
      border: 1px solid rgba(255,255,255,0.02);
    }

    .field-key, .field-count, .field-type, .regex-input {
      background: transparent; border: 1px solid rgba(255,255,255,0.06);
      color: #eafae6; padding:6px 8px; border-radius:6px;
    }
    .field-key { flex:1; }
    .field-type { width:130px; }
    .field-count { width:84px; }

    .btn.add { background: transparent; color: var(--accent); border: 1px dashed rgba(0,255,127,0.12); }
    .btn.primary { background: linear-gradient(90deg, var(--accent), #66ffbb); color:#001; border:none; }

    .output-area {
      padding:14px; height:60vh; overflow:auto; background:#030303; border-radius:6px; font-family:var(--mono); font-size:0.95rem;
      color:#cffff0;
    }

    .schema-area { padding:12px; background: rgba(255,255,255,0.02); border-radius:6px; font-family:var(--mono); font-size:0.9rem; color:#cfeedd; }

    .modal-panel { /* for fallback if using custom modal, but we use Bootstrap modal below */ }

    
    .target-panel { margin-top:14px; padding:12px; border-radius:8px; border:1px solid var(--card-border); background: var(--panel-bg); }
    .target-row label { color:var(--muted); width:130px; }

   
    .drag-handle { cursor:grab; color:var(--muted); width:28px; text-align:center; }
    .small-note { font-size:0.85rem; color:var(--muted); }

    
    @media (max-width: 1000px) {
      .main-grid { flex-direction:column; }
      .left-panel, .right-panel { width:100%; }
      .fields-list { max-height: none; }
      .output-area { height:40vh; }
    }
    
select, select option {
  color: #e0e0e0 !important;
  background-color: #1a1a1a !important;
  opacity: 1 !important;
}

select option:hover,
select option:focus {
  background-color: #333 !important;
  color: #fff !important;
}

    
    .bd-mode-toggle { position:fixed; right:18px; bottom:18px; z-index:1050; }
  </style>
</head>
<body>


<header class="topbar">
  <div class="brand">
    <div class="logo">
      <img src="https://lh3.googleusercontent.com/a-/ALV-UjVv_a5H5w2JQpAOEYro8DrKx4Ame_cE8p6tRgSATA8cSAbssMS_=s300-p-k-rw-no" alt="logo">
    </div>

    <div>
      <h1>Mock Data Forge</h1>
      <p class="muted">CSEA - NITC</p>
    </div>
  </div>

  <div class="ms-auto d-flex align-items-center gap-2">
    <input id="rowCount" type="number" min="1" value="1" class="form-control rows-input" />
    <button id="importExample" class="btn btn-outline-light">Load Example</button>
    <button id="copySchema" class="btn btn-outline-light">Copy Schema</button>
    <button id="generateBtn" class="btn primary">Generate</button>
  </div>
</header>


<main class="main-grid container-fluid">


  <section class="left-panel card p-0">
    <div class="panel-header">
      <h2>Fields</h2>
      <div>
        <button id="addFieldBtn" class="btn btn-sm btn-outline-success">+ Add Field</button>
        <button id="clearBtn" class="btn btn-sm btn-outline-light ms-2">Clear</button>
      </div>
    </div>

    <div id="fieldsList" class="fields-list"></div>

    <div class="p-3">
      <div class="small-note">Tip: Choose <code>object</code> or <code>array</code> then click Edit to add nested fields.</div>
    </div>

    
    <div class="p-3">
      <div class="target-panel">
        <h6 class="mb-2">Automated Entry (API)</h6>

        <div class="row gy-2 align-items-center">
          <label class="col-4 col-form-label">Target Type</label>
          <div class="col-8">
            <select id="targetType" class="form-select form-select-sm">
              <option value="">(none)</option>
              <option value="api">API Endpoint (POST)</option>
            </select>
          </div>

          <label class="col-4 col-form-label">API URL</label>
          <div class="col-8">
            <input id="apiUrl" class="form-control form-control-sm" placeholder="https://webhook.site/..." />
          </div>

          <label class="col-4 col-form-label">Headers (JSON)</label>
          <div class="col-8">
            <input id="apiHeaders" class="form-control form-control-sm" placeholder='{"Authorization":"Bearer ..."}' />
          </div>

          <label class="col-4 col-form-label">Batch Size</label>
          <div class="col-4">
            <input id="apiBatch" type="number" min="1" value="10" class="form-control form-control-sm" />
          </div>

          <label class="col-4 col-form-label">Timeout (ms)</label>
          <div class="col-4">
            <input id="apiTimeout" type="number" min="500" value="15000" class="form-control form-control-sm" />
          </div>

          <label class="col-4 col-form-label">Dry Run</label>
          <div class="col-8">
            <input id="dryRun" type="checkbox" />
            <span class="small-note ms-2">Generate only (no forwarding)</span>
          </div>
        </div>

      </div>
    </div>

  </section>

  
  <section class="right-panel">

    <div class="card mb-3">
      <div class="panel-header">
        <h2>Output</h2>
        <div>
          <button id="copyOutput" class="btn btn-sm btn-outline-light">Copy</button>
          <button id="downloadJson" class="btn btn-sm btn-outline-light ms-2">Download</button>
        </div>
      </div>
      <div class="p-3">
        <pre id="output" class="output-area">No data yet...</pre>
      </div>
    </div>

    <div class="card">
      <div class="panel-header"><h3 class="mb-0">Generated Schema</h3></div>
      <div class="p-3">
        <pre id="schemaPreview" class="schema-area">{}</pre>
      </div>
    </div>

  </section>

</main>


<div class="modal fade" id="nestedModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content bg-dark text-light">
      <div class="modal-header border-0">
        <h5 class="modal-title">Edit Nested Schema</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        <div class="d-flex gap-3 mb-3 align-items-center">
          <label class="mb-0">Mode</label>
          <select id="modalMode" class="form-select form-select-sm w-auto">
            <option value="object">object</option>
            <option value="array">array</option>
          </select>

          <label id="arrayCountLabel" class="mb-0">Count</label>
          <input id="arrayCount" type="number" min="1" value="3" class="form-control form-control-sm w-auto" />
        </div>

        <div id="nestedFieldsContainer" class="d-flex flex-column gap-2"></div>

        <div class="mt-3">
          <button class="btn btn-sm btn-success" id="addNestedBtn">+ Add Nested Field</button>
        </div>

      </div>
      <div class="modal-footer border-0">
        <button class="btn btn-primary" id="saveNestedBtn">Save</button>
        <button class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>


<svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/></symbol>
  <symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/></symbol>
  <symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol>
  <symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13z"/></symbol>
</svg>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>


<script>

let fields = [];
let editingIndex = -1;
let nestedTemp = [];
let nestedMode = "object";
let nestedCount = 3;

const types = [
  "string","integer","float","boolean",
  "name","email","phone","date","uuid",
  "image_url","file_url",
  "regex",
  "object","array"
];

function mkField(key="", type="string"){
  return { key, type, nested: null, count: 3, pattern: "" };
}

function escapeHtml(s){
  return (s || "").toString()
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/"/g,"&quot;");
}


function renderFields(){
  const list = document.getElementById("fieldsList");
  list.innerHTML = "";

  fields.forEach((f, i) => {
    const row = document.createElement("div");
    row.className = "field-row";

    row.innerHTML = `
      <div class="drag-handle">≡</div>

      <input class="field-key form-control form-control-sm" placeholder="field name" value="${escapeHtml(f.key)}" data-i="${i}" />

      <select class="field-type form-select form-select-sm" data-i="${i}">
        ${types.map(t => `<option value="${t}" ${t===f.type?"selected":""}>${t}</option>`).join("")}
      </select>

      ${f.type==="array" ? `<input class="field-count form-control form-control-sm" type="number" min="1" value="${f.count}" data-i="${i}" />` : ""}

      ${f.type==="regex" ? `<input class="regex-input form-control form-control-sm" placeholder="regex pattern (e.g. ORD-[0-9]{5})" value="${escapeHtml(f.pattern || "")}" data-i="${i}" />` : ""}

      ${(f.type==="object" || f.type==="array") ? `<button class="btn btn-sm btn-outline-light edit" data-i="${i}">Edit</button>` : ""}

      <button class="btn btn-sm btn-outline-danger remove" data-i="${i}">X</button>
    `;

    list.appendChild(row);
  });

  attachFieldEvents();
  renderSchemaPreview();
}


function attachFieldEvents(){

  document.querySelectorAll(".field-key").forEach(inp=>{
    inp.oninput = e => {
      const i = e.target.dataset.i;
      fields[i].key = e.target.value;
      renderSchemaPreview();
    };
  });

  document.querySelectorAll(".field-type").forEach(sel=>{
    sel.onchange = e => {
      const i = e.target.dataset.i;
      fields[i].type = e.target.value;

      if(fields[i].type !== "object" && fields[i].type !== "array"){
        fields[i].nested = null;
      }

      renderFields();
    };
  });

  document.querySelectorAll(".field-count").forEach(inp=>{
    inp.oninput = e => {
      const i = e.target.dataset.i;
      fields[i].count = Number(e.target.value) || 1;
    }
  });

  document.querySelectorAll(".regex-input").forEach(inp=>{
    inp.oninput = e => {
      const i = e.target.dataset.i;
      fields[i].pattern = e.target.value;
      renderSchemaPreview();
    };
  });

  document.querySelectorAll(".edit").forEach(btn=>{
    btn.onclick = e => openModal(Number(e.target.dataset.i));
  });

  document.querySelectorAll(".remove").forEach(btn=>{
    btn.onclick = e => {
      const i = e.target.dataset.i;
      fields.splice(i,1);
      renderFields();
    }
  });
}


function buildSchema(){
  const obj = {};
  fields.forEach(f => {
    if(!f.key) return;

    if(f.type === "object" || f.type === "array"){
      obj[f.key] = f.nested;
    } else if (f.type === "regex") {
      obj[f.key] = { type: "regex", pattern: f.pattern || "" };
    } else {
      obj[f.key] = f.type;
    }
  });
  return obj;
}

function renderSchemaPreview(){
  document.getElementById("schemaPreview").innerText =
    JSON.stringify(buildSchema(), null, 2);
}


function safeJSON(s){
  try { return JSON.parse(s); } catch { return null; }
}


async function generate(){
  const schema = buildSchema();
  const rows = Number(document.getElementById("rowCount").value) || 1;
  const dryRun = document.getElementById("dryRun").checked;

  const targetType = document.getElementById("targetType").value;
  let target = null;

  if (targetType === "api") {
    target = {
      type: "api",
      url: document.getElementById("apiUrl").value.trim(),
      headers: safeJSON(document.getElementById("apiHeaders").value) || {},
      batchSize: Number(document.getElementById("apiBatch").value) || 10,
      timeout: Number(document.getElementById("apiTimeout").value) || 15000
    };
  }

  try {
    const res = await fetch("/generate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ schema, rows, target, dryRun })
    });

   
    if (dryRun || !targetType) {
      const text = await res.text();
      document.getElementById("output").innerText = text;
      return;
    }


    const json = await res.json();
    document.getElementById("output").innerText = JSON.stringify(json, null, 2);

  } catch (err) {
    document.getElementById("output").innerText = "Error: " + err.message;
  }
}


document.getElementById("generateBtn").onclick = generate;


const bsModal = new bootstrap.Modal(document.getElementById('nestedModal'), { backdrop: 'static' });

function openModal(i){
  editingIndex = i;
  const f = fields[i];

  nestedMode = f.type === "array" ? "array" : "object";
  document.getElementById("modalMode").value = nestedMode;

  nestedCount = f.count || 3;
  document.getElementById("arrayCount").value = nestedCount;

  document.getElementById("arrayCountLabel").style.display =
    nestedMode==="array" ? "inline-block" : "none";

  nestedTemp = [];

  if(f.nested){
    const fieldsObj = f.type==="array" ? (f.nested.items.fields || {}) : (f.nested.fields || {});
    nestedTemp = Object.entries(fieldsObj).map(([k,v]) => {
      if (typeof v === "object" && v.type === "regex") {
        return { key: k, type: "regex", pattern: v.pattern || "" };
      }
      return { key: k, type: v, pattern: "" };
    });
  }

  if(nestedTemp.length === 0) nestedTemp.push({ key:"field1", type:"string", pattern:"" });

  renderNestedFields();
  bsModal.show();
}

function closeModal(){
  bsModal.hide();
}

function renderNestedFields(){
  const box = document.getElementById("nestedFieldsContainer");
  box.innerHTML = "";

  nestedTemp.forEach((nf, i) => {
    const div = document.createElement("div");
    div.className = "d-flex gap-2 align-items-center";

    div.innerHTML = `
      <input class="form-control form-control-sm nf-key" placeholder="field" value="${escapeHtml(nf.key)}" data-i="${i}" />
      <select class="form-select form-select-sm nf-type" data-i="${i}" style="width:160px;">
        ${types.filter(t => t!=="object" && t!=="array").map(t=>`<option value="${t}" ${t===nf.type?"selected":""}>${t}</option>`).join("")}
      </select>
      ${nf.type === "regex" ? `<input class="form-control form-control-sm nf-pattern" placeholder="pattern" value="${escapeHtml(nf.pattern||'')}" data-i="${i}" />` : ""}
      <button class="btn btn-sm btn-outline-danger remove-nf" data-i="${i}">X</button>
    `;
    box.appendChild(div);
  });

  attachNestedEvents();
}

function attachNestedEvents(){
  document.querySelectorAll(".nf-key").forEach(inp=>{
    inp.oninput = e => nestedTemp[e.target.dataset.i].key = e.target.value;
  });

  document.querySelectorAll(".nf-type").forEach(sel=>{
    sel.onchange = e => {
      const i = Number(e.target.dataset.i);
      nestedTemp[i].type = e.target.value;
      if (e.target.value === "regex" && !nestedTemp[i].pattern) nestedTemp[i].pattern = "";
      renderNestedFields();
    };
  });

  document.querySelectorAll(".nf-pattern").forEach(inp=>{
    inp.oninput = e => nestedTemp[e.target.dataset.i].pattern = e.target.value;
  });

  document.querySelectorAll(".remove-nf").forEach(btn=>{
    btn.onclick = e => {
      nestedTemp.splice(Number(e.target.dataset.i),1);
      renderNestedFields();
    }
  });

  document.getElementById("modalMode").onchange = e=>{
    nestedMode = e.target.value;
    document.getElementById("arrayCountLabel").style.display = nestedMode === "array" ? "inline-block" : "none";
  };

  document.getElementById("arrayCount").oninput = e=>{
    nestedCount = Number(e.target.value) || 1;
  };
}

document.getElementById("addNestedBtn").onclick = ()=>{
  nestedTemp.push({ key:`field${nestedTemp.length+1}`, type:"string", pattern:"" });
  renderNestedFields();
};

document.getElementById("saveNestedBtn").onclick = ()=>{
  if(editingIndex < 0) return;
  const parent = fields[editingIndex];
  const fieldMap = {};
  nestedTemp.forEach(n=>{
    if(n.key && n.key.trim()){
      if(n.type === "regex"){
        fieldMap[n.key.trim()] = { type: "regex", pattern: n.pattern || "" };
      } else {
        fieldMap[n.key.trim()] = n.type;
      }
    }
  });

  if(nestedMode === "object"){
    parent.nested = { type:"object", fields: fieldMap };
  } else {
    parent.nested = { type:"array", count: nestedCount, items: { type:"object", fields: fieldMap } };
    parent.count = nestedCount;
  }

  closeModal();
  renderFields();
};


document.getElementById("addFieldBtn").onclick = ()=>{ fields.push(mkField()); renderFields(); };
document.getElementById("clearBtn").onclick = ()=>{ fields = []; renderFields(); };
document.getElementById("copySchema").onclick = ()=>{ navigator.clipboard.writeText(JSON.stringify(buildSchema(), null, 2)); alert("Schema copied!"); };
document.getElementById("copyOutput").onclick = ()=>{ navigator.clipboard.writeText(document.getElementById("output").innerText); alert("Output copied!"); };
document.getElementById("downloadJson").onclick = ()=>{
  const data = document.getElementById("output").innerText || "{}";
  const blob = new Blob([data], {type:"application/json"});
  const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = "mock-data.json"; a.click();
};
document.getElementById("importExample").onclick = ()=> {
  fields = [ mkField("id","uuid"), mkField("full_name","name"), mkField("email","email"), mkField("profile","object") ];
  fields[3].nested = { type:"object", fields:{ bio:"string", age:"integer", planet:"string" } };
  renderFields();
};


renderFields();

</script>
<footer style="
  margin-top: 40px;
  padding: 18px 0;
  border-top: 1px solid rgba(255,255,255,0.12);
  text-align: center;
  color: rgba(255,255,255,0.6);
  font-size: 14px;
  letter-spacing: 0.3px;
">
  <div style="margin-bottom: 6px; font-weight: 600; color: #00ff99;">
    —
  </div>
  <div>
    © <span id = "year"></span> CSEA, NITC
  </div>
</footer>
<script> document.getElementById("year").textContent = new Date().getFullYear();</script>
</body>
</html>
